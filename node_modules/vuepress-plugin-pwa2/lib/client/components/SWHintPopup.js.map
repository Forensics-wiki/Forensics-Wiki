{"version":3,"file":"SWHintPopup.js","sources":["../../../src/client/components/SWHintPopup.ts"],"sourcesContent":["import type { SlotsType, VNode } from \"vue\";\nimport { Transition, defineComponent, h, onMounted, ref } from \"vue\";\nimport { useLocaleConfig } from \"vuepress-shared/client\";\n\nimport { UpdateIcon } from \"./icons.js\";\nimport { usePWAEvent } from \"../composables/index.js\";\nimport { locales } from \"../define.js\";\n\nimport \"../styles/popup.scss\";\n\nexport default defineComponent({\n  name: \"SWHintPopup\",\n\n  slots: Object as SlotsType<{\n    default?: (props: {\n      enabled: boolean;\n      uninstall: () => void;\n    }) => VNode[] | VNode;\n  }>,\n\n  setup(_props, { slots }) {\n    const locale = useLocaleConfig(locales);\n    const enabled = ref(false);\n\n    const uninstall = (): void => {\n      if (enabled.value) {\n        // force refresh\n        // @ts-ignore\n        window.location.reload(true);\n        enabled.value = false;\n      }\n    };\n\n    onMounted(() => {\n      const event = usePWAEvent();\n\n      event.on(\"updatefound\", () => {\n        void navigator.serviceWorker.getRegistration().then((registration) => {\n          // check whether a valid service worker is active\n          if (registration && registration.active) enabled.value = true;\n        });\n      });\n\n      event.on(\"updated\", () => {\n        enabled.value = false;\n      });\n    });\n\n    return (): VNode =>\n      h(\n        Transition,\n        { name: \"popup\" },\n        () =>\n          slots.default?.({\n            enabled: enabled.value,\n            uninstall,\n          }) ||\n          (enabled.value\n            ? h(\n                \"button\",\n                {\n                  type: \"button\",\n                  class: \"sw-hint-popup\",\n                  tabindex: 0,\n                  onClick: () => uninstall(),\n                },\n                [\n                  locale.value.hint,\n                  h(\"span\", { class: \"icon-wrapper\" }, h(UpdateIcon)),\n                ],\n              )\n            : null),\n      );\n  },\n});\n"],"names":["defineComponent","_props","slots","locale","useLocaleConfig","locales","enabled","ref","uninstall","onMounted","event","usePWAEvent","registration","h","Transition","_a","UpdateIcon"],"mappings":"2QAUA,IAAeA,EAAAA,EAAgB,CAC7B,KAAM,cAEN,MAAO,OAOP,MAAMC,EAAQ,CAAE,MAAAC,CAAM,EAAG,CACvB,MAAMC,EAASC,EAAgBC,CAAO,EAChCC,EAAUC,EAAI,EAAK,EAEnBC,EAAY,IAAY,CACxBF,EAAQ,QAGV,OAAO,SAAS,OAAO,EAAI,EAC3BA,EAAQ,MAAQ,GAEpB,EAEA,OAAAG,EAAU,IAAM,CACd,MAAMC,EAAQC,IAEdD,EAAM,GAAG,cAAe,IAAM,CACvB,UAAU,cAAc,kBAAkB,KAAME,GAAiB,CAEhEA,GAAgBA,EAAa,SAAQN,EAAQ,MAAQ,GAC3D,CAAC,CACH,CAAC,EAEDI,EAAM,GAAG,UAAW,IAAM,CACxBJ,EAAQ,MAAQ,EAClB,CAAC,CACH,CAAC,EAEM,IACLO,EACEC,EACA,CAAE,KAAM,OAAQ,EAChB,IAAG,CApDX,IAAAC,EAqDU,QAAAA,EAAAb,EAAM,UAAN,KAAA,OAAAa,EAAA,KAAAb,EAAgB,CACd,QAASI,EAAQ,MACjB,UAAAE,CACF,CACCF,KAAAA,EAAQ,MACLO,EACE,SACA,CACE,KAAM,SACN,MAAO,gBACP,SAAU,EACV,QAAS,IAAML,EAAU,CAC3B,EACA,CACEL,EAAO,MAAM,KACbU,EAAE,OAAQ,CAAE,MAAO,cAAe,EAAGA,EAAEG,CAAU,CAAC,CACpD,CACF,EACA,KACR,CAAA,CACJ,CACF,CAAC"}