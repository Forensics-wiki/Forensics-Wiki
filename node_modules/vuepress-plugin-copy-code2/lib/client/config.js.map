{"version":3,"file":"config.js","sources":["../../src/client/define.ts","../../src/client/composables/setup.ts","../../src/client/config.ts"],"sourcesContent":["import type { CopyCodeLocaleConfig } from \"../shared/index.js\";\n\ndeclare const COPY_CODE_FANCY: boolean;\ndeclare const COPY_CODE_DELAY: number;\ndeclare const COPY_CODE_DURATION: number;\ndeclare const COPY_CODE_LOCALES: CopyCodeLocaleConfig;\ndeclare const COPY_CODE_SELECTOR: string[];\ndeclare const COPY_CODE_SHOW_IN_MOBILE: boolean;\n\nexport const copyCodeDelay = COPY_CODE_DELAY;\nexport const copyCodeDuration = COPY_CODE_DURATION;\nexport const copyCodeLocales = COPY_CODE_LOCALES;\nexport const copyCodeFancy = COPY_CODE_FANCY;\nexport const copyCodeSelector = COPY_CODE_SELECTOR;\nexport const copyCodeShowInMobile = COPY_CODE_SHOW_IN_MOBILE;\n","/**\n * Forked and edited from https://github.com/vxhly/vuepress-plugin-one-click-copy/blob/master/bin/clientRootMixin.js\n *\n * MIT License\n *\n * Copyright (c) 2019 vxhly <pengchengou@gmail.com>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n * Â© 2019 GitHub, Inc.\n */\n\nimport { usePageData } from \"@vuepress/client\";\nimport { useClipboard, useEventListener } from \"@vueuse/core\";\nimport { nextTick, onMounted, watch } from \"vue\";\nimport { Message, useIsMobile, useLocaleConfig } from \"vuepress-shared/client\";\n\nimport {\n  copyCodeDelay,\n  copyCodeDuration,\n  copyCodeFancy,\n  copyCodeLocales,\n  copyCodeSelector,\n  copyCodeShowInMobile,\n} from \"../define.js\";\n\nif (copyCodeFancy)\n  void import(\n    /* webpackChunkName: \"message\" */ \"vuepress-shared/client/styles/message.scss\"\n  );\n\nconst timeoutIdMap: Map<HTMLElement, NodeJS.Timeout> = new Map();\n\nexport const setupCopyCode = (): void => {\n  const { copy } = useClipboard({ legacy: true });\n  const locale = useLocaleConfig(copyCodeLocales);\n  const page = usePageData();\n  const isMobile = useIsMobile();\n\n  let message: Message;\n\n  const insertCopyButton = (codeBlockElement: HTMLElement): void => {\n    if (!codeBlockElement.hasAttribute(\"copy-code-registered\")) {\n      const copyElement = document.createElement(\"button\");\n\n      copyElement.type = \"button\";\n      copyElement.classList.add(\"copy-code-button\");\n      copyElement.innerHTML = '<div class=\"copy-icon\" />';\n      copyElement.setAttribute(\"aria-label\", locale.value.copy);\n      copyElement.setAttribute(\"data-copied\", locale.value.copied);\n\n      if (copyCodeFancy) {\n        copyElement.classList.add(\"fancy\");\n        copyElement.setAttribute(\"data-balloon-pos\", \"left\");\n      }\n\n      if (codeBlockElement.parentElement)\n        codeBlockElement.parentElement.insertBefore(\n          copyElement,\n          codeBlockElement,\n        );\n\n      codeBlockElement.setAttribute(\"copy-code-registered\", \"\");\n    }\n  };\n\n  const generateCopyButton = (): Promise<void> =>\n    nextTick().then(\n      () =>\n        new Promise((resolve) => {\n          setTimeout(() => {\n            copyCodeSelector.forEach((item) => {\n              document\n                .querySelectorAll<HTMLElement>(item)\n                .forEach(insertCopyButton);\n            });\n            resolve();\n          }, copyCodeDelay || 500);\n        }),\n    );\n\n  const copyCodeBlockContent = (\n    codeContainer: HTMLDivElement,\n    codeContent: HTMLPreElement,\n    button: HTMLButtonElement,\n  ): void => {\n    let { innerText: text = \"\" } = codeContent;\n\n    if (\n      // is shell\n      /language-(shellscript|shell|bash|sh|zsh)/.test(\n        codeContainer.classList.toString(),\n      )\n    )\n      text = text.replace(/^ *(\\$|>) /gm, \"\");\n\n    void copy(text).then(() => {\n      button.classList.add(\"copied\");\n      clearTimeout(timeoutIdMap.get(button));\n\n      const timeoutId = setTimeout(() => {\n        button.classList.remove(\"copied\");\n        button.blur();\n        timeoutIdMap.delete(button);\n      }, copyCodeDuration);\n\n      timeoutIdMap.set(button, timeoutId);\n\n      if (copyCodeFancy) {\n        const CHECK_ICON =\n          '<svg viewBox=\"0 0 1024 1024\" xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"#06a35a\"><path d=\"M822.812 824.618c-83.076 81.992-188.546 124.614-316.05 127.865-122.085-3.251-223.943-45.873-305.935-127.865S76.213 640.406 72.962 518.682c3.251-127.503 45.873-232.973 127.865-316.05 81.992-83.075 184.211-126.058 305.936-129.309 127.503 3.251 232.973 46.234 316.049 129.31 83.076 83.076 126.059 188.546 129.31 316.05-2.89 121.723-46.234 223.943-129.31 305.935zM432.717 684.111c3.973 3.974 8.307 5.78 13.364 6.14 5.057.362 9.753-1.444 13.365-5.417l292.57-287.515c3.974-3.973 5.78-8.307 5.78-13.364s-1.806-9.753-5.78-13.365l1.807 1.806c-3.973-3.973-8.669-5.779-14.087-6.14-5.418-.361-10.475 1.445-14.809 5.418L460.529 592.006c-3.973 3.25-8.669 4.695-14.448 4.695-5.78 0-10.836-1.445-15.531-3.973l-94.273-72.962c-4.335-3.251-9.392-4.335-14.448-3.973s-9.392 3.25-12.642 7.585l-2.89 3.973c-3.25 4.334-4.334 9.391-3.973 14.81.722 5.417 2.528 10.113 5.779 14.086L432.717 684.11z\"/></svg>';\n\n        message.pop(\n          `${CHECK_ICON}<span>${locale.value.hint} ðŸŽ‰</span>`,\n          copyCodeDuration,\n        );\n      }\n    });\n  };\n\n  onMounted(() => {\n    if (copyCodeFancy) message = new Message();\n\n    if (!isMobile.value || copyCodeShowInMobile) void generateCopyButton();\n\n    useEventListener(\"click\", (event) => {\n      const el = event.target as HTMLElement;\n\n      if (el.matches('div[class*=\"language-\"] > button.copy')) {\n        const codeContainer = <HTMLDivElement>el.parentElement;\n        const preBlock = <HTMLPreElement | null>el.nextElementSibling;\n\n        if (preBlock)\n          copyCodeBlockContent(codeContainer, preBlock, <HTMLButtonElement>el);\n      } else if (el.matches('div[class*=\"language-\"] div.copy-icon')) {\n        const buttonElement = <HTMLButtonElement>el.parentElement;\n        const codeContainer = <HTMLDivElement>buttonElement.parentElement;\n        const preBlock = <HTMLPreElement | null>(\n          buttonElement.nextElementSibling\n        );\n\n        if (preBlock)\n          copyCodeBlockContent(codeContainer, preBlock, buttonElement);\n      }\n    });\n\n    watch(\n      () => page.value.path,\n      () => {\n        if (!isMobile.value || copyCodeShowInMobile) void generateCopyButton();\n      },\n    );\n  });\n};\n","import { defineClientConfig } from \"@vuepress/client\";\n\nimport { setupCopyCode } from \"./composables/index.js\";\n\nimport \"balloon-css/balloon.css\";\nimport \"./styles/button.scss\";\n\nexport default defineClientConfig({\n  setup: () => {\n    setupCopyCode();\n  },\n});\n"],"names":["copyCodeDelay","copyCodeDuration","copyCodeLocales","copyCodeFancy","copyCodeSelector","copyCodeShowInMobile","timeoutIdMap","setupCopyCode","copy","useClipboard","locale","useLocaleConfig","page","usePageData","isMobile","useIsMobile","message","insertCopyButton","codeBlockElement","copyElement","generateCopyButton","nextTick","resolve","item","copyCodeBlockContent","codeContainer","codeContent","button","text","timeoutId","CHECK_ICON","onMounted","Message","useEventListener","event","el","preBlock","buttonElement","watch","defineClientConfig"],"mappings":"sVASa,MAAAA,EAAgB,gBAChBC,EAAmB,mBACnBC,EAAkB,kBAClBC,EAAgB,gBAChBC,EAAmB,mBACnBC,EAAuB,yBC2BhCF,GACG,OAC+B,4CACpC,EAEF,MAAMG,EAAiD,IAAI,IAE9CC,EAAgB,IAAY,CACvC,KAAM,CAAE,KAAAC,CAAK,EAAIC,EAAa,CAAE,OAAQ,EAAK,CAAC,EACxCC,EAASC,EAAgBT,CAAe,EACxCU,EAAOC,EAAAA,EACPC,EAAWC,IAEjB,IAAIC,EAEJ,MAAMC,EAAoBC,GAAwC,CAChE,GAAI,CAACA,EAAiB,aAAa,sBAAsB,EAAG,CAC1D,MAAMC,EAAc,SAAS,cAAc,QAAQ,EAEnDA,EAAY,KAAO,SACnBA,EAAY,UAAU,IAAI,kBAAkB,EAC5CA,EAAY,UAAY,4BACxBA,EAAY,aAAa,aAAcT,EAAO,MAAM,IAAI,EACxDS,EAAY,aAAa,cAAeT,EAAO,MAAM,MAAM,EAEvDP,IACFgB,EAAY,UAAU,IAAI,OAAO,EACjCA,EAAY,aAAa,mBAAoB,MAAM,GAGjDD,EAAiB,eACnBA,EAAiB,cAAc,aAC7BC,EACAD,CACF,EAEFA,EAAiB,aAAa,uBAAwB,EAAE,CAC1D,CACF,EAEME,EAAqB,IACzBC,IAAW,KACT,IACE,IAAI,QAASC,GAAY,CACvB,WAAW,IAAM,CACflB,EAAiB,QAASmB,GAAS,CACjC,SACG,iBAA8BA,CAAI,EAClC,QAAQN,CAAgB,CAC7B,CAAC,EACDK,EAAQ,CACV,EAAGtB,GAAiB,GAAG,CACzB,CAAC,CACL,EAEIwB,EAAuB,CAC3BC,EACAC,EACAC,IACS,CACT,GAAI,CAAE,UAAWC,EAAO,EAAG,EAAIF,EAI7B,2CAA2C,KACzCD,EAAc,UAAU,SAAA,CAC1B,IAEAG,EAAOA,EAAK,QAAQ,eAAgB,EAAE,GAEnCpB,EAAKoB,CAAI,EAAE,KAAK,IAAM,CACzBD,EAAO,UAAU,IAAI,QAAQ,EAC7B,aAAarB,EAAa,IAAIqB,CAAM,CAAC,EAErC,MAAME,EAAY,WAAW,IAAM,CACjCF,EAAO,UAAU,OAAO,QAAQ,EAChCA,EAAO,KAAK,EACZrB,EAAa,OAAOqB,CAAM,CAC5B,EAAG1B,CAAgB,EAInB,GAFAK,EAAa,IAAIqB,EAAQE,CAAS,EAE9B1B,EAAe,CACjB,MAAM2B,EACJ,i+BAEFd,EAAQ,IACN,GAAGc,CAAU,SAASpB,EAAO,MAAM,IAAI,aACvCT,CACF,CACF,CACF,CAAC,CACH,EAEA8B,EAAU,IAAM,CACV5B,IAAea,EAAU,IAAIgB,IAE7B,CAAClB,EAAS,OAAST,IAA2Be,EAElDa,EAAAA,EAAiB,QAAUC,GAAU,CACnC,MAAMC,EAAKD,EAAM,OAEjB,GAAIC,EAAG,QAAQ,uCAAuC,EAAG,CACvD,MAAMV,EAAgCU,EAAG,cACnCC,EAAkCD,EAAG,mBAEvCC,GACFZ,EAAqBC,EAAeW,EAA6BD,CAAE,CACvE,SAAWA,EAAG,QAAQ,uCAAuC,EAAG,CAC9D,MAAME,EAAmCF,EAAG,cACtCV,EAAgCY,EAAc,cAC9CD,EACJC,EAAc,mBAGZD,GACFZ,EAAqBC,EAAeW,EAAUC,CAAa,CAC/D,CACF,CAAC,EAEDC,EACE,IAAM1B,EAAK,MAAM,KACjB,IAAM,EACA,CAACE,EAAS,OAAST,IAA2Be,EACpD,CAAA,CACF,CACF,CAAC,CACH,ECjKA,IAAemB,EAAAA,EAAmB,CAChC,MAAO,IAAM,CACXhC,EAAc,CAChB,CACF,CAAC"}