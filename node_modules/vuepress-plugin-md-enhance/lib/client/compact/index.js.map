{"version":3,"file":"index.js","sources":["../../../src/client/compact/components/CodeGroup.ts"],"sourcesContent":["import type { Component, FunctionalComponent, SlotsType, VNode } from \"vue\";\nimport { defineComponent, h, onBeforeUpdate, ref, shallowRef } from \"vue\";\n\nimport \"../styles/code-group.scss\";\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\ndeclare const __VUEPRESS_DEV__: boolean;\n\nexport interface CodeGroupItemProps {\n  title: string;\n  active?: boolean;\n}\n\nexport const CodeGroupItem: FunctionalComponent<\n  CodeGroupItemProps,\n  Record<never, never>,\n  { default: () => VNode | VNode[] | undefined }\n> = ({ active = false }, { slots }): VNode =>\n  h(\n    \"div\",\n    {\n      class: [\"code-group-item\", { active }],\n      \"aria-selected\": active,\n    },\n    slots.default?.(),\n  );\n\nCodeGroupItem.displayName = \"CodeGroupItem\";\n\nexport const CodeGroup = defineComponent({\n  name: \"CodeGroup\",\n\n  slots: Object as SlotsType<{\n    default: () => VNode[];\n  }>,\n\n  setup(_props, { slots }) {\n    // index of current active item\n    const activeIndex = ref(-1);\n\n    // refs of the tab buttons\n    const tabRefs = shallowRef<HTMLUListElement[]>([]);\n\n    // after removing a code-group-item, we need to clear the ref\n    // of the removed item to avoid issues caused by HMR\n    if (__VUEPRESS_DEV__)\n      onBeforeUpdate(() => {\n        tabRefs.value = [];\n      });\n\n    // activate next tab\n    const activateNext = (i = activeIndex.value): void => {\n      activeIndex.value = i < tabRefs.value.length - 1 ? i + 1 : 0;\n      tabRefs.value[activeIndex.value].focus();\n    };\n\n    // activate previous tab\n    const activatePrev = (i = activeIndex.value): void => {\n      activeIndex.value = i > 0 ? i - 1 : tabRefs.value.length - 1;\n      tabRefs.value[activeIndex.value].focus();\n    };\n\n    // handle keyboard event\n    const keyboardHandler = (event: KeyboardEvent, i: number): void => {\n      if (event.key === \" \" || event.key === \"Enter\") {\n        event.preventDefault();\n        activeIndex.value = i;\n      } else if (event.key === \"ArrowRight\") {\n        event.preventDefault();\n        activateNext(i);\n      } else if (event.key === \"ArrowLeft\") {\n        event.preventDefault();\n        activatePrev(i);\n      }\n    };\n\n    return (): VNode | null => {\n      // NOTICE: here we put the `slots.default()` inside the render function to make\n      // the slots reactive, otherwise the slot content wonâ€™t be changed once the\n      // `setup()` function of current component is called\n\n      // get children code-group-item\n      const items = (slots.default?.() || [])\n        .filter((vNode) => (vNode.type as Component).name === \"CodeGroupItem\")\n        .map((vNode) => {\n          if (vNode.props === null) vNode.props = {};\n\n          return vNode as VNode & { props: Exclude<VNode[\"props\"], null> };\n        });\n\n      // do not render anything if there is no code-group-item\n      if (items.length === 0) return null;\n\n      // if `activeIndex` is invalid\n      if (activeIndex.value < 0 || activeIndex.value > items.length - 1) {\n        // find the index of the code-group-item with `active` props\n        activeIndex.value = items.findIndex((vNode) => \"active\" in vNode.props);\n\n        // if there is no `active` props on code-group-item, set the first item active\n        if (activeIndex.value === -1) activeIndex.value = 0;\n      }\n      // set the active item\n      else {\n        items.forEach((vNode, index) => {\n          vNode.props[\"active\"] = index === activeIndex.value;\n        });\n      }\n\n      return h(\"div\", { class: \"code-group\" }, [\n        h(\n          \"div\",\n          { class: \"code-group-nav\" },\n          items.map((vNode, index) => {\n            const isActive = index === activeIndex.value;\n\n            return h(\n              \"button\",\n              {\n                type: \"button\",\n                ref: (element) => {\n                  if (element) tabRefs.value[index] = <HTMLUListElement>element;\n                },\n                class: [\"code-group-nav-tab\", { active: isActive }],\n                \"aria-pressed\": isActive,\n                \"aria-expanded\": isActive,\n                onClick: () => {\n                  activeIndex.value = index;\n                },\n                onKeydown: (event: KeyboardEvent) =>\n                  keyboardHandler(event, index),\n              },\n              <string[]>vNode.props[\"title\"],\n            );\n          }),\n        ),\n        items,\n      ]);\n    };\n  },\n});\n"],"names":["CodeGroupItem","active","slots","_a","h","CodeGroup","defineComponent","_props","activeIndex","ref","tabRefs","shallowRef","onBeforeUpdate","activateNext","i","activatePrev","keyboardHandler","event","items","vNode","index","isActive","element"],"mappings":"2HAaa,MAAAA,EAIT,CAAC,CAAE,OAAAC,EAAS,EAAM,EAAG,CAAE,MAAAC,CAAM,IAAU,CAjB3C,IAAAC,EAkBE,OAAAC,EACE,MACA,CACE,MAAO,CAAC,kBAAmB,CAAE,OAAAH,CAAO,CAAC,EACrC,gBAAiBA,CACnB,GACAE,EAAAD,EAAM,UAAN,YAAAC,EAAA,KAAAD,CACF,CAAA,CAAA,EAEFF,EAAc,YAAc,sBAEfK,EAAYC,EAAgB,CACvC,KAAM,YAEN,MAAO,OAIP,MAAMC,EAAQ,CAAE,MAAAL,CAAM,EAAG,CAEvB,MAAMM,EAAcC,EAAI,EAAE,EAGpBC,EAAUC,EAA+B,CAAE,CAAA,EAI7C,kBACFC,EAAe,IAAM,CACnBF,EAAQ,MAAQ,CAClB,CAAA,CAAC,EAGH,MAAMG,EAAe,CAACC,EAAIN,EAAY,QAAgB,CACpDA,EAAY,MAAQM,EAAIJ,EAAQ,MAAM,OAAS,EAAII,EAAI,EAAI,EAC3DJ,EAAQ,MAAMF,EAAY,KAAK,EAAE,OACnC,EAGMO,EAAe,CAACD,EAAIN,EAAY,QAAgB,CACpDA,EAAY,MAAQM,EAAI,EAAIA,EAAI,EAAIJ,EAAQ,MAAM,OAAS,EAC3DA,EAAQ,MAAMF,EAAY,KAAK,EAAE,MAAM,CACzC,EAGMQ,EAAkB,CAACC,EAAsBH,IAAoB,CAC7DG,EAAM,MAAQ,KAAOA,EAAM,MAAQ,SACrCA,EAAM,iBACNT,EAAY,MAAQM,GACXG,EAAM,MAAQ,cACvBA,EAAM,eAAe,EACrBJ,EAAaC,CAAC,GACLG,EAAM,MAAQ,cACvBA,EAAM,eAAA,EACNF,EAAaD,CAAC,EAElB,EAEA,MAAO,IAAoB,CA5E/B,IAAAX,EAkFM,MAAMe,KAASf,EAAAD,EAAM,UAAN,KAAAC,OAAAA,EAAA,KAAAD,CAAqB,IAAA,CAAA,GACjC,OAAQiB,GAAWA,EAAM,KAAmB,OAAS,eAAe,EACpE,IAAKA,IACAA,EAAM,QAAU,OAAMA,EAAM,MAAQ,CAEjCA,GAAAA,EACR,EAGH,OAAID,EAAM,SAAW,EAAU,MAG3BV,EAAY,MAAQ,GAAKA,EAAY,MAAQU,EAAM,OAAS,GAE9DV,EAAY,MAAQU,EAAM,UAAWC,GAAU,WAAYA,EAAM,KAAK,EAGlEX,EAAY,QAAU,KAAIA,EAAY,MAAQ,IAIlDU,EAAM,QAAQ,CAACC,EAAOC,IAAU,CAC9BD,EAAM,MAAM,OAAYC,IAAUZ,EAAY,KAChD,CAAC,EAGIJ,EAAE,MAAO,CAAE,MAAO,YAAa,EAAG,CACvCA,EACE,MACA,CAAE,MAAO,gBAAiB,EAC1Bc,EAAM,IAAI,CAACC,EAAOC,IAAU,CAC1B,MAAMC,EAAWD,IAAUZ,EAAY,MAEvC,OAAOJ,EACL,SACA,CACE,KAAM,SACN,IAAMkB,GAAY,CACZA,IAASZ,EAAQ,MAAMU,CAAK,EAAsBE,EACxD,EACA,MAAO,CAAC,qBAAsB,CAAE,OAAQD,CAAS,CAAC,EAClD,eAAgBA,EAChB,gBAAiBA,EACjB,QAAS,IAAM,CACbb,EAAY,MAAQY,CACtB,EACA,UAAYH,GACVD,EAAgBC,EAAOG,CAAK,CAChC,EACUD,EAAM,MAAM,KACxB,CACF,CAAC,CACH,EACAD,CACF,CAAC,EACH,CACF,CACF,CAAC"}