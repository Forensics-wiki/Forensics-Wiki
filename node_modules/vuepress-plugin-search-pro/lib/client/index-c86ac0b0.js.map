{"version":3,"file":"index-c86ac0b0.js","sources":["../../src/client/define.ts","../../src/client/helpers/slimsearch.ts","../../src/client/utils/searchWorker.ts"],"sourcesContent":["import type {\n  SearchProCustomFieldFormatter,\n  SearchProHotKeyOptions,\n  SearchProLocaleConfig,\n} from \"../shared/index.js\";\n\ntype SearchProClientCustomFiledConfig = Record<\n  string,\n  SearchProCustomFieldFormatter\n>;\n\ndeclare const SEARCH_PRO_ENABLE_AUTO_SUGGESTIONS: boolean;\ndeclare const SEARCH_PRO_CUSTOM_FIELDS: SearchProClientCustomFiledConfig;\ndeclare const SEARCH_PRO_OPTIONS: {\n  searchDelay: number;\n  suggestDelay: number;\n  queryHistoryCount: number;\n  resultHistoryCount: number;\n  hotKeys: SearchProHotKeyOptions[];\n  worker: string;\n};\ndeclare const SEARCH_PRO_LOCALES: SearchProLocaleConfig;\n\nexport const searchProOptions = SEARCH_PRO_OPTIONS;\n\nexport const enableAutoSuggestions = SEARCH_PRO_ENABLE_AUTO_SUGGESTIONS;\nexport const searchProClientCustomFiledConfig = SEARCH_PRO_CUSTOM_FIELDS;\nexport const searchProHotKeys = searchProOptions.hotKeys;\nexport const searchProLocales = SEARCH_PRO_LOCALES;\nexport const clientWorker = new URL(\"./worker/index.js\", import.meta.url);\n","import type { App } from \"vue\";\nimport { inject } from \"vue\";\n\nimport type { SearchOptions } from \"../typings/index.js\";\n\ndeclare const __VUEPRESS_DEV__: boolean;\n\nlet slimsearchOptions: SearchOptions = {};\n\nconst slimsearchSymbol = Symbol(__VUEPRESS_DEV__ ? \"slimsearch\" : \"\");\n\nexport const defineSearchConfig = (options: SearchOptions): void => {\n  slimsearchOptions = options;\n};\n\nexport const useSearchOptions = (): SearchOptions => inject(slimsearchSymbol)!;\n\nexport const injectSearchConfig = (app: App): void => {\n  app.provide(slimsearchSymbol, slimsearchOptions);\n};\n","import { clientWorker, searchProOptions } from \"../define.js\";\nimport type {\n  MessageData,\n  QueryResult,\n  SearchResult,\n} from \"../typings/index.js\";\n\ndeclare const __VUEPRESS_BASE__: string;\ndeclare const __VUEPRESS_DEV__: boolean;\n\nexport interface SearchWorker {\n  search: <T extends MessageData>(\n    options: T,\n  ) => Promise<\n    T[\"type\"] extends \"search\"\n      ? SearchResult[]\n      : T[\"type\"] extends \"suggest\"\n      ? string[]\n      : QueryResult\n  >;\n  terminate: () => void;\n}\n\nexport const createSearchWorker = (): SearchWorker => {\n  // service worker with module only works on webkit browsers now, so we only used it in dev\n  const worker = new Worker(\n    __VUEPRESS_DEV__\n      ? clientWorker\n      : `${__VUEPRESS_BASE__}${searchProOptions.worker}`,\n    __VUEPRESS_DEV__ ? { type: \"module\" } : {},\n  );\n  const queue: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    resolve: (args: any) => void;\n    reject: (err: Error) => void;\n  }[] = [];\n\n  worker.addEventListener(\n    \"message\",\n    ({ data }: MessageEvent<SearchResult[]>) => {\n      const { resolve } = queue.shift()!;\n\n      resolve(data);\n    },\n  );\n\n  return {\n    search: <T extends MessageData>(\n      options: T,\n    ): Promise<\n      T[\"type\"] extends \"search\"\n        ? SearchResult[]\n        : T[\"type\"] extends \"suggest\"\n        ? string[]\n        : QueryResult\n    > =>\n      new Promise((resolve, reject) => {\n        worker.postMessage(options);\n        queue.push({ resolve, reject });\n      }),\n    terminate: (): void => {\n      worker.terminate();\n      queue.forEach(({ reject }) =>\n        reject(new Error(\"Worker has been terminated.\")),\n      );\n    },\n  };\n};\n"],"names":["searchProOptions","enableAutoSuggestions","searchProClientCustomFiledConfig","searchProHotKeys","searchProLocales","clientWorker","slimsearchOptions","slimsearchSymbol","defineSearchConfig","options","useSearchOptions","inject","injectSearchConfig","app","createSearchWorker","worker","queue","data","resolve","reject"],"mappings":"6BAuBO,MAAMA,EAAmB,mBAEnBC,EAAwB,mCACxBC,EAAmC,yBACnCC,EAAmBH,EAAiB,QACpCI,EAAmB,mBACnBC,EAAe,IAAI,IAAI,oBAAqB,YAAY,GAAG,ECtBxE,IAAIC,EAAmC,CAAC,EAExC,MAAMC,EAAmB,OAAO,iBAAmB,aAAe,EAAE,EAEvDC,EAAsBC,GAAiC,CAClEH,EAAoBG,CACtB,EAEaC,EAAmB,IAAqBC,EAAOJ,CAAgB,EAE/DK,EAAsBC,GAAmB,CACpDA,EAAI,QAAQN,EAAkBD,CAAiB,CACjD,ECIaQ,EAAqB,IAAoB,CAEpD,MAAMC,EAAS,IAAI,OACjB,iBACIV,EACA,GAAG,iBAAiB,GAAGL,EAAiB,MAAM,GAClD,iBAAmB,CAAE,KAAM,QAAS,EAAI,CAAA,CAC1C,EACMgB,EAIA,CAEN,EAAA,OAAAD,EAAO,iBACL,UACA,CAAC,CAAE,KAAAE,CAAK,IAAoC,CAC1C,KAAM,CAAE,QAAAC,CAAQ,EAAIF,EAAM,MAAM,EAEhCE,EAAQD,CAAI,CACd,CACF,EAEO,CACL,OACER,GAQA,IAAI,QAAQ,CAACS,EAASC,IAAW,CAC/BJ,EAAO,YAAYN,CAAO,EAC1BO,EAAM,KAAK,CAAE,QAAAE,EAAS,OAAAC,CAAO,CAAC,CAChC,CAAC,EACH,UAAW,IAAY,CACrBJ,EAAO,UAAU,EACjBC,EAAM,QAAQ,CAAC,CAAE,OAAAG,CAAO,IACtBA,EAAO,IAAI,MAAM,6BAA6B,CAAC,CACjD,CACF,CACF,CACF"}