import{useRouteLocale as $}from"@vuepress/client";import{isString as ee,isPlainObject as le}from"@vuepress/shared";import{useLocalStorage as _,useDebounceFn as ae,useEventListener as se}from"@vueuse/core";import{ref as k,shallowRef as te,onMounted as re,watch as F,onUnmounted as ue,defineComponent as oe,toRef as ie,computed as b,h as a}from"vue";import{useRouter as U}from"vue-router";import{useLocaleConfig as ne,VPLink as M}from"vuepress-shared/client";import{H as Y,C as j,S as ce,T as ve,a as he,b as pe}from"../closeIcon-72fa80fe.js";import{s as q,u as ye,c as de,a as me,b as fe}from"../index-c86ac0b0.js";import"../styles/search-result.scss";const ge="SEARCH_PRO_QUERY_HISTORY",y=_(ge,[]),He=()=>{const{queryHistoryCount:r}=q,i=r>0;return{enabled:i,queryHistory:y,addQueryHistory:t=>{i&&(y.value.length<r?y.value=Array.from(new Set([t,...y.value])):y.value=Array.from(new Set([t,...y.value.slice(0,r-1)])))},removeQueryHistory:t=>{y.value=[...y.value.slice(0,t),...y.value.slice(t+1)]}}},Re="SEARCH_PRO_RESULT_HISTORY",{resultHistoryCount:O}=q,d=_(Re,[]),Se=()=>{const r=U(),i=O>0,t=s=>r.resolve({name:s.key,..."anchor"in s?{hash:`#${s.anchor}`}:{}}).fullPath;return{enabled:i,resultHistory:d,addResultHistory:s=>{if(i){const u={link:t(s),display:s.display};"header"in s&&(u.header=s.header),d.value.length<O?d.value=[u,...d.value]:d.value=[u,...d.value.slice(0,O-1)]}},removeResultHistory:s=>{d.value=[...d.value.slice(0,s),...d.value.slice(s+1)]}}},Qe=r=>{const i=ye(),t=$(),{search:s,terminate:u}=de(),f=k(!1),g=te([]);return re(()=>{const m=()=>{g.value=[],f.value=!1},C=ae(H=>{f.value=!0,H?s({type:"search",query:H,locale:t.value,options:i}).then(p=>{g.value=p,f.value=!1}).catch(p=>{console.error(p),m()}):m()},q.searchDelay);F([r,t],()=>C(r.value),{immediate:!0}),ue(()=>{u()})}),{searching:f,results:g}};var ke=oe({name:"SearchResult",props:{query:{type:String,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(r,{emit:i}){const t=U(),s=$(),u=ne(me),{enabled:f,addQueryHistory:g,queryHistory:m,removeQueryHistory:C}=He(),{enabled:H,resultHistory:p,addResultHistory:A,removeResultHistory:N}=Se(),I=f||H,x=ie(r,"query"),{results:R,searching:V}=Qe(x),n=k({isQuery:!0,index:0}),h=k(0),c=k(0),T=b(()=>I&&(m.value.length>0||p.value.length>0)),w=b(()=>R.value.length>0),L=b(()=>R.value[h.value]||null),D=e=>t.resolve({name:e.key,..."anchor"in e?{hash:`#${e.anchor}`}:{}}).fullPath,W=()=>{const{isQuery:e,index:l}=n.value;l===0?n.value={isQuery:!e,index:e?p.value.length-1:m.value.length-1}:n.value={isQuery:e,index:l-1}},B=()=>{const{isQuery:e,index:l}=n.value;l===(e?m.value.length-1:p.value.length-1)?n.value={isQuery:!e,index:0}:n.value={isQuery:e,index:l+1}},z=()=>{h.value=h.value>0?h.value-1:R.value.length-1,c.value=L.value.contents.length-1},G=()=>{h.value=h.value<R.value.length-1?h.value+1:0,c.value=0},J=()=>{c.value<L.value.contents.length-1?c.value=c.value+1:G()},K=()=>{c.value>0?c.value=c.value-1:z()},P=e=>e.map(l=>ee(l)?l:a(l[0],l[1])),X=e=>{if(e.type==="customField"){const l=fe[e.index]||"$content",[o,Q=""]=le(l)?l[s.value].split("$content"):l.split("$content");return e.display.map(v=>a("div",P([o,...v,Q])))}return e.display.map(l=>a("div",P(l)))},S=()=>{h.value=0,c.value=0,i("updateQuery",""),i("close")};return se("keydown",e=>{if(r.isFocusing){if(w.value){if(e.key==="ArrowUp")K();else if(e.key==="ArrowDown")J();else if(e.key==="Enter"){const l=L.value.contents[c.value],o=D(l);g(r.query),A(l),t.push(o),S()}}else if(H){if(e.key==="ArrowUp")W();else if(e.key==="ArrowDown")B();else if(e.key==="Enter"){const{index:l}=n.value;n.value.isQuery?(i("updateQuery",m.value[l]),e.preventDefault()):(t.push(p.value[l].link),S())}}}}),F([h,c],()=>{var e;(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>a("div",{class:["search-pro-result-wrapper",{empty:x.value?!w.value:!T.value}],id:"search-pro-results"},x.value===""?I?T.value?[f?a("ul",{class:"search-pro-result-list"},a("li",{class:"search-pro-result-list-item"},[a("div",{class:"search-pro-result-title"},u.value.history),m.value.map((e,l)=>a("div",{class:["search-pro-result-item",{active:n.value.isQuery&&n.value.index===l}],onClick:()=>{i("updateQuery",e)}},[a(Y,{class:"search-pro-result-type"}),a("div",{class:"search-pro-result-content"},e),a("button",{class:"search-pro-remove-icon",innerHTML:j,onClick:o=>{o.preventDefault(),o.stopPropagation(),C(l)}})]))])):null,H?a("ul",{class:"search-pro-result-list"},a("li",{class:"search-pro-result-list-item"},[a("div",{class:"search-pro-result-title"},u.value.history),p.value.map((e,l)=>a(M,{to:e.link,class:["search-pro-result-item",{active:!n.value.isQuery&&n.value.index===l}],onClick:()=>{S()}},()=>[a(Y,{class:"search-pro-result-type"}),a("div",{class:"search-pro-result-content"},[e.header?a("div",{class:"content-header"},e.header):null,a("div",e.display.map(o=>P(o)).flat())]),a("button",{class:"search-pro-remove-icon",innerHTML:j,onClick:o=>{o.preventDefault(),o.stopPropagation(),N(l)}})]))])):null]:u.value.emptyHistory:u.value.emptyResult:V.value?a(ce,{hint:u.value.searching}):w.value?a("ul",{class:"search-pro-result-list"},R.value.map(({title:e,contents:l},o)=>{const Q=h.value===o;return a("li",{class:["search-pro-result-list-item",{active:Q}]},[a("div",{class:"search-pro-result-title"},e||u.value.defaultTitle),l.map((v,Z)=>{const E=Q&&c.value===Z;return a(M,{to:D(v),class:["search-pro-result-item",{active:E,"aria-selected":E}],onClick:()=>{g(r.query),A(v),S()}},()=>[v.type==="text"?null:a(v.type==="title"?ve:v.type==="heading"?he:pe,{class:"search-pro-result-type"}),a("div",{class:"search-pro-result-content"},[v.type==="text"&&v.header?a("div",{class:"content-header"},v.header):null,a("div",X(v))])])})])})):u.value.emptyResult)}});export{ke as default};
//# sourceMappingURL=SearchResult.js.map
