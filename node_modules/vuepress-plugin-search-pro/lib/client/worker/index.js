import{search as k,getStoredFields as C,autoSuggest as R,loadJSONIndex as w}from"slimsearch";import T from"@temp/search-pro/index";import{entries as $}from"vuepress-shared/client";const d=(l,e)=>{const n=l.toLowerCase(),s=e.toLowerCase(),o=[];let t=0,a=0;const i=(c,u=!1)=>{let r="";a===0?r=c.length>20?`… ${c.slice(-20)}`:c:u?r=c.length+a>100?`${c.slice(0,100-a)}… `:c:r=c.length>20?`${c.slice(0,20)} … ${c.slice(-20)}`:c,r&&o.push(r),a+=r.length,u||(o.push(["mark",e]),a+=e.length,a>=100&&o.push(" …"))};let p=n.indexOf(s,t);if(p===-1)return null;for(;p>=0;){const c=p+s.length;if(i(l.slice(t,p)),t=c,a>100)break;p=n.indexOf(s,t)}return a<100&&i(l.slice(t),!0),o},x=/[\u4e00-\u9fa5]/g,S=(l={})=>({fuzzy:.2,prefix:!0,processTerm:e=>{const n=e.match(x)||[],s=e.replace(x,"").toLowerCase();return s?[s,...n]:[...n]},...l}),E=(l,e)=>e.contents.reduce((n,[,s])=>n+s,0)-l.contents.reduce((n,[,s])=>n+s,0),F=(l,e)=>Math.max(...e.contents.map(([,n])=>n))-Math.max(...l.contents.map(([,n])=>n)),M=(l,e,n={})=>{const s={};return k(e,l,S({boost:{h:2,t:1,c:4},...n})).forEach(o=>{const{id:t,terms:a,score:i}=o,p=t.includes("@"),c=t.includes("#"),[u,r]=t.split(/[#@]/),{contents:f}=s[u]??={title:"",contents:[]};if(p)f.push([{type:"customField",key:u,index:r,display:a.map(g=>o.c.map(h=>d(h,g))).flat().filter(g=>g!==null)},i]);else{const g=a.map(h=>d(o.h,h)).filter(h=>h!==null);if(g.length&&f.push([{type:c?"heading":"title",key:u,...c&&{anchor:r},display:g},i]),"t"in o)for(const h of o.t){const y=a.map(m=>d(h,m)).filter(m=>m!==null);y.length&&f.push([{type:"text",key:u,...c&&{anchor:r},display:y},i])}}}),$(s).sort(([,o],[,t])=>SEARCH_PRO_SORT_STRATEGY==="total"?E(o,t):F(o,t)).map(([o,{title:t,contents:a}])=>{if(!t){const i=C(e,o);i&&(t=i.h)}return{title:t,contents:a.map(([i])=>i)}})},O=(l,e,n={})=>R(e,l,S(n)).map(({suggestion:s})=>s);self.onmessage=async({data:{type:l="all",query:e,locale:n,options:s}})=>{const{default:o}=await T[n](),t=w(o,{fields:["h","t","c"],storeFields:["h","t","c"]});l==="suggest"?self.postMessage(O(e,t,s)):l==="search"?self.postMessage(M(e,t,s)):self.postMessage({suggestions:O(e,t,s),results:M(e,t,s)})};
//# sourceMappingURL=index.js.map
