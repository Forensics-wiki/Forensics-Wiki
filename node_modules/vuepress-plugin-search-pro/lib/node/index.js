import{watch as K}from"chokidar";import{useSassPalettePlugin as G}from"vuepress-plugin-sass-palette";import{ensureEndingSlash as C,Logger as B,getPageExcerpt as V,fromEntries as z,isArray as W,keys as L,entries as R,checkVersion as Z,getLocales as M,addViteOptimizeDepsInclude as U,addViteSsrNoExternal as X}from"vuepress-shared/node";import{getDirname as Y,path as H,colors as O,fs as T}from"@vuepress/utils";import{load as Q}from"cheerio";import{createIndex as ee,addAllAsync as te,discard as N,addAll as ae,vacuum as D}from"slimsearch";const P=Y(import.meta.url),$=C(H.resolve(P,"../client/")),ie=C(H.resolve(P,"../worker/")),f="vuepress-plugin-search-pro",_=new B(f),S=e=>e.replace(/\//g,"")||"root",E=({options:e,deprecatedOption:a,newOption:i,msg:t="",scope:r=""})=>{if(a in e){if(_.warn(`${O.magenta(a)} is ${O.yellow("deprecated")}${r?` in ${r}`:""}, please use "${O.magenta(i)}" instead.${t?`
${t}`:""}`),i.includes(".")){const l=i.split(".");let s=e;l.forEach((n,c)=>{c!==l.length-1?(s[n]=s[n]||{},s=s[n]):s[n]=e[a]})}else e[i]=e[a];delete e[a]}},se=e=>{E({options:e,deprecatedOption:"fullIndex",newOption:"indexContent"}),E({options:e,deprecatedOption:"historyCount",newOption:"resultHistoryCount"}),E({options:e,deprecatedOption:"delay",newOption:"searchDelay"})},ne=e=>{const{pages:a,pluginApi:i}=e;i.plugins.some(({name:t})=>t==="vuepress-plugin-blog2")||a.some(t=>"excerpt"in t.data)||a.forEach(t=>{t.data.excerpt=V(e,t,{excerptLength:0})})},re="h2,h3,h4,h5,h6".split(","),oe="header,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,li,main,ol,p,ul,caption,table,thead,tbody,tfoot,th,tr,td,datalist,fieldset,form,legend,optgroup,option,select,details,dialog,menu,menuitem,summary,blockquote,pre".split(","),le="routerlink,a,b,abbr,bdi,bdo,cite,code,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,del,ins,button,label,legend,meter,optgroup,option,output,progress,select".split(","),ce=Q(""),j=e=>e.children.map(a=>a.type==="tag"?a.name==="a"&&a.attribs.class==="header-anchor"?"":j(a):a.type==="text"?a.data:"").join(" ").replace(/\s+/gu," ").trim(),I=(e,a=[],i=!1)=>{const{contentRendered:t,data:r,title:l}=e,s=e.key,n="excerpt"in r&&r.excerpt.length,c={id:s,h:l},u=[c];let h=n||i,d=null,p="",y=!0;const x=(o,g=!1)=>{if(o.type==="tag")if(re.includes(o.name)){const m=o.attribs.id,w=j(o);p&&h&&(((y?c:d).t??=[]).push(p.replace(/\s+/gu," ")),p=""),m?(y?y=!1:u.push(d),d={id:`${s}#${m}`,h:w}):w&&((d??c).t??=[]).push(w)}else oe.includes(o.name)?(p&&h&&(((y?c:d).t??=[]).push(p.replace(/\s+/gu," ")),p=""),o.childNodes.forEach(m=>x(m,g||o.name==="pre"))):le.includes(o.name)&&o.childNodes.forEach(m=>x(m,g));else o.type==="text"?p+=g||o.data.trim()?o.data:"":n&&!i&&o.type==="comment"&&o.data.trim()==="more"&&(h=!1)},v=ce.parseHTML(t),A=z(a.map(({getter:o},g)=>{const m=o(e);return W(m)?[g.toString(),m]:m?[g.toString(),[m]]:null}).filter(o=>o!==null));return!(v!=null&&v.length)&&!L(A).length?[]:(v==null||v.forEach(o=>{x(o)}),h&&p&&((y?c:d).t??=[]).push(p),d&&u.push(d),R(A).forEach(([o,g])=>{u.push({id:`${s}@${o}`,c:g})}),u)},q=async(e,{customFields:a,indexContent:i,indexOptions:t,indexLocaleOptions:r})=>{const l={};e.pages.forEach(n=>{const c=I(n,a,i);(l[n.pathLocale]??=[]).push(...c)});const s={};return await Promise.all(R(l).map(async([n,c])=>{const u=ee({...t,...r==null?void 0:r[n],fields:["h","t","c"],storeFields:["h","a","t","c"]});await te(u,c),s[n]=u})),s},ue=async(e,a)=>{const i=e.dir.dest(a.worker||"search-pro.worker.js"),t=JSON.stringify(await q(e,a)),r=`${ie}index.js`,l=await T.readFile(r,"utf8");await T.ensureDir(H.dirname(i)),await T.writeFile(i,l.replace("SEARCH_PRO_INDEX",()=>`${JSON.stringify(t)}`).replace("SEARCH_PRO_SORT_STRATEGY",JSON.stringify(a.sortStrategy||"max")))},de={"/en/":{cancel:"Cancel",placeholder:"Search",search:"Search",searching:"Searching",defaultTitle:"Documentation",select:"to select",navigate:"to navigate",autocomplete:"to autocomplete",exit:"to exit",history:"Search History",emptyHistory:"Empty Search History",emptyResult:"No results found",loading:"Loading search indexes..."},"/zh/":{cancel:"å–æ¶ˆ",placeholder:"æœç´¢",search:"æœç´¢",searching:"æœç´¢ä¸­",defaultTitle:"æ–‡æ¡£",select:"é€‰æ‹©",navigate:"åˆ‡æ¢",autocomplete:"è‡ªåŠ¨è¡¥å…¨",exit:"å…³é—­",history:"æœç´¢åŽ†å²",emptyHistory:"æ— æœç´¢åŽ†å²",emptyResult:"æ²¡æœ‰æ‰¾åˆ°ç»“æžœ",loading:"æ­£åœ¨åŠ è½½æœç´¢ç´¢å¼•..."},"/zh-tw/":{cancel:"å–æ¶ˆ",placeholder:"æœç´¢",search:"æœç´ ",searching:"æœç´¢ä¸­",defaultTitle:"æ–‡æª”",select:"é¸æ“‡",navigate:"åˆ‡æ›",autocomplete:"è‡ªå‹•è£œå…¨",exit:"é—œé–‰",history:"æœç´¢æ­·å²",emptyHistory:"ç„¡æœç´¢æ­·å²",emptyResult:"æ²’æœ‰æ‰¾åˆ°çµæžœ",loading:"æ­£åœ¨åŠ è¼‰æœç´¢ç´¢å¼•..."},"/de/":{cancel:"Abbrechen",placeholder:"Suche",search:"Suche",searching:"Suche",defaultTitle:"Dokumentation",select:"auswÃ¤hlen",navigate:"wechseln",autocomplete:"automatisch vervollstÃ¤ndigen",exit:"schlieÃŸen",history:"Suchverlauf",emptyHistory:"Suchverlauf leeren",emptyResult:"Keine Ergebnisse gefunden",loading:"Suchindex wird geladen..."},"/de-at/":{cancel:"Abbrechen",placeholder:"Suche",search:"Suche",searching:"Suche",defaultTitle:"Dokumentation",select:"auswÃ¤hlen",navigate:"wechseln",autocomplete:"automatisch vervollstÃ¤ndigen",exit:"schlieÃŸen",history:"Suchverlauf",emptyHistory:"Suchverlauf leeren",emptyResult:"Keine Ergebnisse gefunden",loading:"Suchindex wird geladen..."},"/vi/":{cancel:"Há»§y",placeholder:"TÃ¬m kiáº¿m",search:"TÃ¬m kiáº¿m",searching:"Äang tÃ¬m kiáº¿m",defaultTitle:"TÃ i liá»‡u",select:"chá»n",navigate:"chuyá»ƒn",autocomplete:"tá»± Ä‘á»™ng hoÃ n thÃ nh",exit:"Ä‘Ã³ng",history:"Lá»‹ch sá»­ tÃ¬m kiáº¿m",emptyHistory:"XÃ³a lá»‹ch sá»­ tÃ¬m kiáº¿m",emptyResult:"KhÃ´ng tÃ¬m tháº¥y káº¿t quáº£",loading:"Äang táº£i chá»‰ má»¥c tÃ¬m kiáº¿m..."},"/uk/":{cancel:"Ð¡ÐºÐ°ÑÑƒÐ²Ð°Ñ‚Ð¸",placeholder:"ÐŸÐ¾ÑˆÑƒÐº",search:"ÐŸÐ¾ÑˆÑƒÐº",searching:"ÐŸÐ¾ÑˆÑƒÐº",defaultTitle:"Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ñ–Ñ",select:"Ð²Ð¸Ð±Ñ€Ð°Ñ‚Ð¸",navigate:"Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸",autocomplete:"Ð°Ð²Ñ‚Ð¾Ð·Ð°Ð¿Ð¾Ð²Ð½ÐµÐ½Ð½Ñ",exit:"Ð·Ð°ÐºÑ€Ð¸Ñ‚Ð¸",history:"Ð†ÑÑ‚Ð¾Ñ€Ñ–Ñ Ð¿Ð¾ÑˆÑƒÐºÑƒ",emptyHistory:"ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚Ð¸ Ñ–ÑÑ‚Ð¾Ñ€Ñ–ÑŽ Ð¿Ð¾ÑˆÑƒÐºÑƒ",emptyResult:"ÐÑ–Ñ‡Ð¾Ð³Ð¾ Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾",loading:"Ð—Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½Ð½Ñ Ð¿Ð¾ÑˆÑƒÐºÐ¾Ð²Ð¸Ñ… Ñ–Ð½Ð´ÐµÐºÑÑ–Ð²..."},"/ru/":{cancel:"ÐžÑ‚Ð¼ÐµÐ½Ð°",placeholder:"ÐŸÐ¾Ð¸ÑÐº",search:"ÐŸÐ¾Ð¸ÑÐº",searching:"ÐŸÐ¾Ð¸ÑÐº",defaultTitle:"Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ",select:"Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ",navigate:"Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",autocomplete:"Ð°Ð²Ñ‚Ð¾Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ",exit:"Ð·Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ",history:"Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¿Ð¾Ð¸ÑÐºÐ°",emptyHistory:"ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ Ð¿Ð¾Ð¸ÑÐºÐ°",emptyResult:"ÐÐ¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾",loading:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¿Ð¾Ð¸ÑÐºÐ¾Ð²Ñ‹Ñ… Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð²..."},"/br/":{cancel:"Cancelar",placeholder:"Pesquisar",search:"Pesquisar",searching:"Pesquisando",defaultTitle:"DocumentaÃ§Ã£o",select:"selecionar",navigate:"navegar",autocomplete:"autocompletar",exit:"fechar",history:"HistÃ³rico de pesquisa",emptyHistory:"Limpar histÃ³rico de pesquisa",emptyResult:"Nenhum resultado encontrado",loading:"Carregando Ã­ndices de pesquisa..."},"/pl/":{cancel:"Anuluj",placeholder:"Szukaj",search:"Szukaj",searching:"Szukanie",defaultTitle:"Dokumentacja",select:"wybierz",navigate:"przejdÅº",autocomplete:"autouzupeÅ‚nianie",exit:"zamknij",history:"Historia wyszukiwania",emptyHistory:"WyczyÅ›Ä‡ historiÄ™ wyszukiwania",emptyResult:"Nie znaleziono wynikÃ³w",loading:"Åadowanie indeksÃ³w wyszukiwania..."},"/sk/":{cancel:"ZruÅ¡iÅ¥",placeholder:"HÄ¾adaÅ¥",search:"HÄ¾adaÅ¥",searching:"HÄ¾adanie",defaultTitle:"DokumentÃ¡cia",select:"vybraÅ¥",navigate:"prepnÃºÅ¥",autocomplete:"automatickÃ© dopÄºÅˆanie",exit:"zavrieÅ¥",history:"HistÃ³ria vyhÄ¾adÃ¡vania",emptyHistory:"VymazaÅ¥ histÃ³riu vyhÄ¾adÃ¡vania",emptyResult:"NenaÅ¡li sa Å¾iadne vÃ½sledky",loading:"NaÄÃ­tavajÃº sa vyhÄ¾adÃ¡vacie indexy..."},"/fr/":{cancel:"Annuler",placeholder:"Rechercher",search:"Rechercher",searching:"Recherche",defaultTitle:"Documentation",select:"sÃ©lectionner",navigate:"naviguer",autocomplete:"auto-complÃ©tion",exit:"fermer",history:"Historique de recherche",emptyHistory:"Vider l'historique de recherche",emptyResult:"Aucun rÃ©sultat trouvÃ©",loading:"Chargement des index de recherche..."},"/es/":{cancel:"Cancelar",placeholder:"Buscar",search:"Buscar",searching:"Buscando",defaultTitle:"DocumentaciÃ³n",select:"seleccionar",navigate:"navegar",autocomplete:"autocompletar",exit:"cerrar",history:"Historial de bÃºsqueda",emptyHistory:"Vaciar historial de bÃºsqueda",emptyResult:"No se encontraron resultados",loading:"Cargando Ã­ndices de bÃºsqueda..."},"/ja/":{cancel:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«",placeholder:"æ¤œç´¢",search:"æ¤œç´¢",searching:"æ¤œç´¢ä¸­",defaultTitle:"ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ",select:"é¸æŠž",navigate:"åˆ‡ã‚Šæ›¿ãˆ",autocomplete:"ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ",exit:"é–‰ã˜ã‚‹",history:"æ¤œç´¢å±¥æ­´",emptyHistory:"æ¤œç´¢å±¥æ­´ã‚’ã‚¯ãƒªã‚¢",emptyResult:"çµæžœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",loading:"æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™..."},"/tr/":{cancel:"Ä°ptal",placeholder:"Ara",search:"Ara",searching:"AranÄ±yor",defaultTitle:"DÃ¶kÃ¼mantasyon",select:"seÃ§",navigate:"geÃ§",autocomplete:"otomatik tamamlama",exit:"kapat",history:"Arama geÃ§miÅŸi",emptyHistory:"Arama geÃ§miÅŸini temizle",emptyResult:"SonuÃ§ bulunamadÄ±",loading:"Arama dizinleri yÃ¼kleniyor..."},"/ko/":{cancel:"ì·¨ì†Œ",placeholder:"ê²€ìƒ‰",search:"ê²€ìƒ‰",searching:"ê²€ìƒ‰ ì¤‘",defaultTitle:"ë¬¸ì„œ",select:"ì„ íƒ",navigate:"ì´ë™",autocomplete:"ìžë™ ì™„ì„±",exit:"ë‹«ê¸°",history:"ê²€ìƒ‰ ê¸°ë¡",emptyHistory:"ê²€ìƒ‰ ê¸°ë¡ ì§€ìš°ê¸°",emptyResult:"ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",loading:"ê²€ìƒ‰ ì¸ë±ìŠ¤ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘..."},"/fi/":{cancel:"Peruuta",placeholder:"Etsi",search:"Etsi",searching:"EtsitÃ¤Ã¤n",defaultTitle:"Dokumentaatio",select:"valitaksesi",navigate:"navigoidaksesi",autocomplete:"automaattinen tÃ¤ydennys",exit:"poistuaksesi",history:"Hakuhistoria",emptyHistory:"TyhjennÃ¤ hakuhistoria",emptyResult:"Tuloksia ei lÃ¶ytynyt",loading:"Ladataan hakuindeksiÃ¤..."},"/hu/":{cancel:"MÃ©gse",placeholder:"KeresÃ©s",search:"KeresÃ©s",searching:"KeresÃ©s",defaultTitle:"DokumentÃ¡ciÃ³",select:"kivÃ¡lasztÃ¡shoz",navigate:"navigÃ¡lÃ¡shoz",autocomplete:"automatikus kiegÃ©szÃ­tÃ©s",exit:"kilÃ©pÃ©shez",history:"KeresÃ©si elÅ‘zmÃ©nyek",emptyHistory:"Ãœres keresÃ©si elÅ‘zmÃ©nyek",emptyResult:"Nincs talÃ¡lat",loading:"A keresÃ©si indexek betÃ¶ltÃ©se..."},"/id/":{cancel:"Batal",placeholder:"Cari sesuatu ðŸ”Ž",search:"Cari",searching:"Sedang mencari",defaultTitle:"Dokumentasi",select:"pilih",navigate:"navigasi",autocomplete:"autoselesai",exit:"keluar",history:"Riwayat Penelusuran",emptyHistory:"Tidak ada riwayat penelusuran",emptyResult:"Hasil penelusuran tidak tersedia",loading:"Memuat indeks penelusuran..."},"/nl/":{cancel:"Annuleren",placeholder:"Zoeken",search:"Zoeken",searching:"Zoeken",defaultTitle:"Documentatie",select:"Selecteren",navigate:"to navigate",autocomplete:"autocompletion",exit:"to exit",history:"Zoekgeschiedenis",emptyHistory:"Zoekgeschiedenis Leegmaken",emptyResult:"Geen resultaten gevonden",loading:"Laden van zoekindexen..."}};let k=null;const b=async(e,a)=>{if(e.env.isDev){const i=await q(e,a);k=i,await Promise.all(R(i).map(([t,r])=>e.writeTemp(`search-pro/${S(t)}.js`,`export default ${JSON.stringify(JSON.stringify(r))};`))),await e.writeTemp("search-pro/index.js",`export default {${L(i).map(t=>`${JSON.stringify(t)}: () => import('./${S(t)}.js')`).join(",")}}`)}},F=async(e,a,i)=>{if(k){const t=i.replace(/^pages\//,"").replace(/\/index\.html\.vue/,"/readme.md").replace(/\.html\.vue/,".md"),{pages:r,writeTemp:l}=e,s=r.find(({filePathRelative:n})=>(n==null?void 0:n.toLowerCase())===t.toLowerCase());if(s){const n=I(s,a.customFields,a.indexContent),{pathLocale:c,key:u}=s,h=k[c];if(n){Array.from(h._documentIds.values()).filter(p=>p.startsWith(u)).forEach(p=>N(h,p)),ae(h,n),await D(h);const d=`export default ${JSON.stringify(JSON.stringify(h))}
`;await l(`search-pro/${S(c)}.js`,d);return}}}await b(e,a)},pe=async(e,a,i)=>{if(k){const t=i.replace(/^pages\//,"").replace(/\/index\.html\.vue/,"/readme.md").replace(/\.html\.vue/,".md"),{pages:r,writeTemp:l}=e,s=r.find(({filePathRelative:n})=>(n==null?void 0:n.toLowerCase())===t.toLowerCase());if(s){const{pathLocale:n,key:c}=s,u=k[n];Array.from(u._documentIds.values()).filter(d=>d.startsWith(c)).forEach(d=>N(u,d)),await D(u);const h=`export default ${JSON.stringify(JSON.stringify(u))}
`;await l(`search-pro/${S(n)}.js`,h);return}}await b(e,a)},he=(e,a=!0)=>i=>(a&&se(e),G(i,{id:"hope"}),Z(i,f,"2.0.0-beta.66"),i.env.isDebug&&_.info("Options:",e),{name:f,alias:{[`${f}/result`]:`${$}components/SearchResult.js`},define:{SEARCH_PRO_ENABLE_AUTO_SUGGESTIONS:e.autoSuggestions!==!1,SEARCH_PRO_CUSTOM_FIELDS:z((e.customFields||[]).map(({formatter:t},r)=>t?[r.toString(),t]:null).filter(t=>t!==null)),SEARCH_PRO_LOCALES:M({app:i,name:f,config:e.locales,default:de}),SEARCH_PRO_OPTIONS:{searchDelay:e.searchDelay||150,suggestDelay:e.suggestDelay||0,queryHistoryCount:e.queryHistoryCount||5,resultHistoryCount:e.resultHistoryCount||5,hotKeys:e.hotKeys||[{key:"k",ctrl:!0},{key:"/",ctrl:!0}],worker:e.worker||"search-pro.worker.js"},SEARCH_PRO_SORT_STRATEGY:JSON.stringify(e.sortStrategy||"max")},clientConfigFile:`${$}config.js`,extendsBundlerOptions:(t,r)=>{U(t,r,"slimsearch"),X(t,r,["fflate","vuepress-shared"])},onInitialized:t=>ne(t),onPrepared:t=>b(t,e),onWatched:(t,r)=>{if("hotReload"in e?e.hotReload:t.env.isDebug){const l=K("pages/**/*.vue",{cwd:t.dir.temp(),ignoreInitial:!0});l.on("add",s=>{F(t,e,s)}),l.on("change",s=>{F(t,e,s)}),l.on("unlink",s=>{pe(t,e,s)}),r.push(l)}},onGenerated:t=>ue(t,e)});var J=(e=>(e.heading="h",e.anchor="a",e.text="t",e.customFields="c",e))(J||{});export{J as IndexField,he as searchProPlugin};
//# sourceMappingURL=index.js.map
