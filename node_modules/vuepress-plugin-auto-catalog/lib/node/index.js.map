{"version":3,"file":"index.js","sources":["../../src/node/utils.ts","../../src/node/autoCatalog.ts","../../src/node/compact/utils.ts","../../src/node/compact/convert.ts","../../src/node/locales.ts","../../src/node/plugin.ts"],"sourcesContent":["import { getDirname, path } from \"@vuepress/utils\";\nimport { Logger, ensureEndingSlash } from \"vuepress-shared/node\";\n\nconst __dirname = getDirname(import.meta.url);\n\nexport const PLUGIN_NAME = \"vuepress-plugin-auto-catalog\";\n\nexport const logger = new Logger(PLUGIN_NAME);\n\nexport const CLIENT_FOLDER = ensureEndingSlash(\n  path.resolve(__dirname, \"../client\"),\n);\n","import type { App, PageFrontmatter } from \"@vuepress/core\";\nimport { createPage } from \"@vuepress/core\";\nimport { getTitleFromFilename } from \"vuepress-shared/node\";\n\nimport type { AutoCatalogOptions } from \"./options.js\";\nimport { logger } from \"./utils.js\";\n\nexport const injectCatalogInformation = (\n  { pages }: App,\n  {\n    component,\n    iconGetter,\n    iconRouteMetaKey = \"icon\",\n    shouldIndex,\n    indexRouteMetaKey = \"index\",\n    orderGetter,\n    orderRouteMetaKey = \"order\",\n    titleGetter = (page): string => page.title,\n    titleRouteMetaKey = \"title\",\n  }: AutoCatalogOptions,\n): void => {\n  if (!component)\n    pages.forEach((page) => {\n      const data: Record<string, unknown> = {};\n\n      const pageTitle = titleGetter?.(page);\n      const pageIcon = iconGetter?.(page);\n      const pageIndex = shouldIndex?.(page) ?? null;\n      const pageOrder = orderGetter?.(page) ?? null;\n\n      if (pageTitle) data[titleRouteMetaKey] = pageTitle;\n      if (pageIcon) data[iconRouteMetaKey] = pageIcon;\n      if (typeof pageIndex === \"boolean\")\n        data[indexRouteMetaKey] = pageIndex ? 1 : 0;\n      if (typeof pageOrder === \"number\") data[orderRouteMetaKey] = pageOrder;\n\n      page.routeMeta = { ...page.routeMeta, ...data };\n    });\n};\n\nexport const generateCatalog = async (\n  app: App,\n  {\n    component = \"AutoCatalog\",\n    exclude = [],\n    frontmatter = (): PageFrontmatter => ({}),\n    level = 3,\n    index = false,\n  }: AutoCatalogOptions,\n): Promise<void> => {\n  const {\n    env: { isDebug },\n    pages,\n  } = app;\n\n  const pathToBeGenerated = new Set<string>();\n  const content = `\\\n<${component}${[1, 2].includes(level) ? ` :level=\"${level}\"` : \"\"}${\n    index ? \" index\" : \"\"\n  }/>\n`;\n\n  pages.forEach(({ path: pagePath, pathLocale }) => {\n    let catalogPath = pagePath;\n\n    // not 404 page\n    if (pagePath !== \"/404.html\")\n      while (catalogPath !== pathLocale) {\n        catalogPath = catalogPath.replace(/\\/(?:[^/]+\\/?)$/, \"/\");\n\n        if (\n          // not discovered yet\n          !pathToBeGenerated.has(catalogPath) &&\n          // not being excluded\n          exclude.every((pattern) => !catalogPath.match(pattern)) &&\n          // path not found\n          pages.every(({ path }) => path !== catalogPath)\n        ) {\n          if (isDebug) logger.info(`Generating catalog ${catalogPath}}`);\n\n          pathToBeGenerated.add(catalogPath);\n        }\n      }\n  });\n\n  await Promise.all(\n    Array.from(pathToBeGenerated)\n      .map((path) => decodeURI(path))\n      .map((path) => {\n        const [, basename = \"\"] = /\\/([^/]+)\\/?$/.exec(path) || [];\n        const title = getTitleFromFilename(basename);\n\n        return createPage(app, {\n          frontmatter: {\n            title,\n            ...(frontmatter(path) || {}),\n          },\n          content,\n          path,\n        });\n      }),\n  ).then((pages) => {\n    app.pages.push(...pages);\n  });\n};\n","import { colors } from \"@vuepress/utils\";\n\nimport { logger } from \"../utils.js\";\n\nexport interface DeprecatedLoggerOptions {\n  options: Record<string, unknown>;\n  deprecatedOption: string;\n  newOption: string;\n  msg?: string;\n  scope?: string;\n}\n\nexport const deprecatedLogger = ({\n  options,\n  deprecatedOption,\n  newOption,\n  msg = \"\",\n  scope = \"\",\n}: DeprecatedLoggerOptions): void => {\n  if (deprecatedOption in options) {\n    logger.warn(\n      `${colors.magenta(deprecatedOption)} is ${colors.yellow(\"deprecated\")}${\n        scope ? ` in ${scope}` : \"\"\n      }, please use \"${colors.magenta(newOption)}\" instead.${\n        msg ? `\\n${msg}` : \"\"\n      }`,\n    );\n\n    if (newOption.includes(\".\")) {\n      const keys = newOption.split(\".\");\n      let temp = options;\n\n      keys.forEach((key, index) => {\n        if (index !== keys.length - 1) {\n          // ensure level exists\n          temp[key] = temp[key] || {};\n\n          temp = temp[key] as Record<string, unknown>;\n        } else {\n          temp[key] = options[deprecatedOption];\n        }\n      });\n    } else {\n      options[newOption] = options[deprecatedOption];\n    }\n\n    delete options[deprecatedOption];\n  }\n};\n\nexport const droppedLogger = (\n  options: Record<string, unknown>,\n  droppedOption: string,\n  hint = \"\",\n  newOption = \"\",\n): void => {\n  if (droppedOption in options) {\n    logger.error(\n      `\"${colors.magenta(droppedOption)}\" is ${colors.red(\"removed\")}${\n        newOption\n          ? `, please use ${colors.magenta(newOption)} instead.`\n          : \" and no longer supported\"\n      }${hint ? `\\n${hint}` : \"\"}`,\n    );\n\n    if (!newOption) delete options[droppedOption];\n  }\n};\n","import { colors } from \"@vuepress/utils\";\n\nimport { deprecatedLogger, droppedLogger } from \"./utils.js\";\nimport type { AutoCatalogOptions } from \"../options.js\";\n\n/** @deprecated */\nexport const convertOptions = (\n  options: AutoCatalogOptions & Record<string, unknown>,\n): void => {\n  deprecatedLogger({\n    options,\n    deprecatedOption: \"getTitle\",\n    newOption: \"titleGetter\",\n  });\n  deprecatedLogger({\n    options,\n    deprecatedOption: \"getIcon\",\n    newOption: \"iconGetter\",\n  });\n  deprecatedLogger({\n    options,\n    deprecatedOption: \"getOrder\",\n    newOption: \"orderGetter\",\n  });\n  deprecatedLogger({\n    options,\n    deprecatedOption: \"getIndex\",\n    newOption: \"shouldIndex\",\n  });\n\n  droppedLogger(\n    options,\n    \"iconComponent\",\n    `please use ${colors.magenta(\n      \"defineAutoCatalogIconComponent\",\n    )} in client config file.`,\n  );\n};\n","import type { AutoCatalogLocaleConfig } from \"../shared/index.js\";\n\nexport const locales: AutoCatalogLocaleConfig = {\n  \"/en/\": {\n    title: \"Catalog\",\n    empty: \"No catalog\",\n  },\n\n  \"/zh/\": {\n    title: \"目录\",\n    empty: \"暂无目录\",\n  },\n\n  \"/zh-tw/\": {\n    title: \"目錄\",\n    empty: \"暫無目錄\",\n  },\n\n  \"/de/\": {\n    title: \"Katalog\",\n    empty: \"Kein Katalog\",\n  },\n\n  \"/de-at/\": {\n    title: \"Katalog\",\n    empty: \"Kein Katalog\",\n  },\n\n  \"/vi/\": {\n    title: \"Danh mục\",\n    empty: \"Không có danh mục\",\n  },\n\n  \"/uk/\": {\n    title: \"Каталог\",\n    empty: \"Немає каталогу\",\n  },\n\n  \"/ru/\": {\n    title: \"Каталог\",\n    empty: \"Нет каталога\",\n  },\n\n  \"/br/\": {\n    title: \"Catálogo\",\n    empty: \"Sem catálogo\",\n  },\n\n  \"/pl/\": {\n    title: \"Katalog\",\n    empty: \"Brak katalogu\",\n  },\n\n  \"/sk/\": {\n    title: \"Katalóg\",\n    empty: \"Žiadny katalóg\",\n  },\n\n  \"/fr/\": {\n    title: \"Catalogue\",\n    empty: \"Pas de catalogue\",\n  },\n\n  \"/es/\": {\n    title: \"Catálogo\",\n    empty: \"Sin catálogo\",\n  },\n\n  \"/ja/\": {\n    title: \"カタログ\",\n    empty: \"カタログなし\",\n  },\n\n  \"/tr/\": {\n    title: \"Katalog\",\n    empty: \"Katalog yok\",\n  },\n\n  \"/ko/\": {\n    title: \"목차\",\n    empty: \"목차 없음\",\n  },\n\n  \"/fi/\": {\n    title: \"Luettelo\",\n    empty: \"Ei luetteloa\",\n  },\n\n  \"/hu/\": {\n    title: \"Katalógus\",\n    empty: \"Nincs katalógus\",\n  },\n\n  \"/id/\": {\n    title: \"Katalog\",\n    empty: \"Tidak ada katalog\",\n  },\n\n  \"/nl/\": {\n    title: \"Catalogus\",\n    empty: \"Geen catalogus\",\n  },\n};\n","import type { PluginFunction } from \"@vuepress/core\";\nimport { useSassPalettePlugin } from \"vuepress-plugin-sass-palette\";\nimport { checkVersion, getLocales } from \"vuepress-shared/node\";\n\nimport { generateCatalog, injectCatalogInformation } from \"./autoCatalog.js\";\nimport { convertOptions } from \"./compact/index.js\";\nimport { locales as defaultLocales } from \"./locales.js\";\nimport type { AutoCatalogOptions } from \"./options.js\";\nimport { CLIENT_FOLDER, PLUGIN_NAME, logger } from \"./utils.js\";\n\nexport const autoCatalogPlugin =\n  (options: AutoCatalogOptions = {}, legacy = true): PluginFunction =>\n  (app) => {\n    if (legacy)\n      convertOptions(options as AutoCatalogOptions & Record<string, unknown>);\n\n    checkVersion(app, PLUGIN_NAME, \"2.0.0-beta.66\");\n\n    if (app.env.isDebug) logger.info(\"Options:\", options);\n\n    useSassPalettePlugin(app, { id: \"hope\" });\n\n    const {\n      component,\n      iconRouteMetaKey = \"icon\",\n      indexRouteMetaKey = \"index\",\n      locales,\n      orderRouteMetaKey = \"order\",\n      titleRouteMetaKey = \"title\",\n    } = options;\n\n    return {\n      name: PLUGIN_NAME,\n\n      define: (): Record<string, unknown> => ({\n        AUTO_CATALOG_LOCALES: getLocales({\n          app,\n          name: PLUGIN_NAME,\n          default: defaultLocales,\n          config: locales,\n        }),\n        AUTO_CATALOG_TITLE_META_KEY: titleRouteMetaKey,\n        AUTO_CATALOG_ICON_META_KEY: iconRouteMetaKey,\n        AUTO_CATALOG_ORDER_META_KEY: orderRouteMetaKey,\n        AUTO_CATALOG_INDEX_META_KEY: indexRouteMetaKey,\n      }),\n\n      onInitialized: async (app): Promise<void> => {\n        injectCatalogInformation(app, options);\n        await generateCatalog(app, options);\n      },\n\n      ...(component ? {} : { clientConfigFile: `${CLIENT_FOLDER}config.js` }),\n    };\n  };\n"],"names":["__dirname","getDirname","PLUGIN_NAME","logger","Logger","CLIENT_FOLDER","ensureEndingSlash","path","injectCatalogInformation","pages","component","iconGetter","iconRouteMetaKey","shouldIndex","indexRouteMetaKey","orderGetter","orderRouteMetaKey","titleGetter","page","titleRouteMetaKey","data","pageTitle","pageIcon","pageIndex","pageOrder","generateCatalog","app","exclude","frontmatter","level","index","isDebug","pathToBeGenerated","content","pagePath","pathLocale","catalogPath","pattern","basename","title","getTitleFromFilename","createPage","deprecatedLogger","options","deprecatedOption","newOption","msg","scope","colors","keys","temp","key","droppedLogger","droppedOption","hint","convertOptions","locales","autoCatalogPlugin","legacy","checkVersion","useSassPalettePlugin","getLocales","defaultLocales"],"mappings":"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"}